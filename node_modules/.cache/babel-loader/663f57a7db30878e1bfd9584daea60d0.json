{"ast":null,"code":"// OP_0 [signatures ...]\nvar Buffer = require('safe-buffer').Buffer;\nvar bscript = require('../../script');\nvar p2mso = require('./output');\nvar typeforce = require('typeforce');\nvar OPS = require('bitcoin-ops');\nfunction partialSignature(value) {\n  return value === OPS.OP_0 || bscript.isCanonicalSignature(value);\n}\nfunction check(script, allowIncomplete) {\n  var chunks = bscript.decompile(script);\n  if (chunks.length < 2) return false;\n  if (chunks[0] !== OPS.OP_0) return false;\n  if (allowIncomplete) {\n    return chunks.slice(1).every(partialSignature);\n  }\n  return chunks.slice(1).every(bscript.isCanonicalSignature);\n}\ncheck.toJSON = function () {\n  return 'multisig input';\n};\nvar EMPTY_BUFFER = Buffer.allocUnsafe(0);\nfunction encodeStack(signatures, scriptPubKey) {\n  typeforce([partialSignature], signatures);\n  if (scriptPubKey) {\n    var scriptData = p2mso.decode(scriptPubKey);\n    if (signatures.length < scriptData.m) {\n      throw new TypeError('Not enough signatures provided');\n    }\n    if (signatures.length > scriptData.pubKeys.length) {\n      throw new TypeError('Too many signatures provided');\n    }\n  }\n  return [].concat(EMPTY_BUFFER, signatures.map(function (sig) {\n    if (sig === OPS.OP_0) {\n      return EMPTY_BUFFER;\n    }\n    return sig;\n  }));\n}\nfunction encode(signatures, scriptPubKey) {\n  return bscript.compile(encodeStack(signatures, scriptPubKey));\n}\nfunction decodeStack(stack, allowIncomplete) {\n  typeforce(check, stack, allowIncomplete);\n  return stack.slice(1);\n}\nfunction decode(buffer, allowIncomplete) {\n  var stack = bscript.decompile(buffer);\n  return decodeStack(stack, allowIncomplete);\n}\nmodule.exports = {\n  check: check,\n  decode: decode,\n  decodeStack: decodeStack,\n  encode: encode,\n  encodeStack: encodeStack\n};","map":{"version":3,"names":["Buffer","require","bscript","p2mso","typeforce","OPS","partialSignature","value","OP_0","isCanonicalSignature","check","script","allowIncomplete","chunks","decompile","length","slice","every","toJSON","EMPTY_BUFFER","allocUnsafe","encodeStack","signatures","scriptPubKey","scriptData","decode","m","TypeError","pubKeys","concat","map","sig","encode","compile","decodeStack","stack","buffer","module","exports"],"sources":["/Users/oddfl3x/Code/bridge2/NATI<>bridge_API_SWAP/node_modules/@bitgo/utxo-lib/dist/src/templates/multisig/input.js"],"sourcesContent":["// OP_0 [signatures ...]\nvar Buffer = require('safe-buffer').Buffer;\nvar bscript = require('../../script');\nvar p2mso = require('./output');\nvar typeforce = require('typeforce');\nvar OPS = require('bitcoin-ops');\nfunction partialSignature(value) {\n    return value === OPS.OP_0 || bscript.isCanonicalSignature(value);\n}\nfunction check(script, allowIncomplete) {\n    var chunks = bscript.decompile(script);\n    if (chunks.length < 2)\n        return false;\n    if (chunks[0] !== OPS.OP_0)\n        return false;\n    if (allowIncomplete) {\n        return chunks.slice(1).every(partialSignature);\n    }\n    return chunks.slice(1).every(bscript.isCanonicalSignature);\n}\ncheck.toJSON = function () { return 'multisig input'; };\nvar EMPTY_BUFFER = Buffer.allocUnsafe(0);\nfunction encodeStack(signatures, scriptPubKey) {\n    typeforce([partialSignature], signatures);\n    if (scriptPubKey) {\n        var scriptData = p2mso.decode(scriptPubKey);\n        if (signatures.length < scriptData.m) {\n            throw new TypeError('Not enough signatures provided');\n        }\n        if (signatures.length > scriptData.pubKeys.length) {\n            throw new TypeError('Too many signatures provided');\n        }\n    }\n    return [].concat(EMPTY_BUFFER, signatures.map(function (sig) {\n        if (sig === OPS.OP_0) {\n            return EMPTY_BUFFER;\n        }\n        return sig;\n    }));\n}\nfunction encode(signatures, scriptPubKey) {\n    return bscript.compile(encodeStack(signatures, scriptPubKey));\n}\nfunction decodeStack(stack, allowIncomplete) {\n    typeforce(check, stack, allowIncomplete);\n    return stack.slice(1);\n}\nfunction decode(buffer, allowIncomplete) {\n    var stack = bscript.decompile(buffer);\n    return decodeStack(stack, allowIncomplete);\n}\nmodule.exports = {\n    check: check,\n    decode: decode,\n    decodeStack: decodeStack,\n    encode: encode,\n    encodeStack: encodeStack\n};\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"script"}